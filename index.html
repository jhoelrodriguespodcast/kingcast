<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KingCast Podcast</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #333; }
    .cover { display: block; margin: 0 auto 20px; max-width: 100%; border-radius: 10px; }
    .folder { background: #fff; margin: 10px auto; border-radius: 10px; max-width: 700px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .folder-header { padding: 15px; cursor: pointer; font-size: 1.2em; font-weight: bold; border-bottom: 1px solid #ddd; }
    .folder-content { display: none; padding: 10px 15px; }
    .podcast { margin-bottom: 15px; }
    audio { width: 100%; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>üéôÔ∏è KingCast Podcast</h1>
  <img src="kingCast.png" alt="Capa do Podcast" class="cover">

  <div id="folders"></div>

  <script>
    const repoOwner = "jhoelrodriguespodcast";
    const repoName = "kingcast";

    // Fun√ß√£o para formatar nomes
    function niceTitle(name) {
      return name.replace(/\.mp3$/i, '').replace(/[_-]/g, ' ');
    }

    // Accordion de abrir/fechar
    function toggleFolder(folderId) {
      const content = document.getElementById(folderId);
      content.style.display = content.style.display === "block" ? "none" : "block";
    }

    // Fun√ß√£o autoplay do pr√≥ximo
    function playNext(currentAudio) {
      const allAudios = [...document.querySelectorAll("audio")];
      const index = allAudios.indexOf(currentAudio);
      if (index >= 0 && index < allAudios.length - 1) {
        allAudios[index + 1].play();
      }
    }

    async function loadFolders() {
      try {
        // Pega lista de pastas
        const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents`);
        const items = await res.json();
        const folders = items.filter(i => i.type === "dir");

        const container = document.getElementById("folders");

        for (const folder of folders) {
          const folderId = "folder_" + folder.name;

          // Cria container da pasta
          const folderDiv = document.createElement("div");
          folderDiv.className = "folder";
          folderDiv.innerHTML = `
            <div class="folder-header" onclick="toggleFolder('${folderId}')">
              üìÇ ${folder.name}
            </div>
            <div class="folder-content" id="${folderId}"></div>
          `;
          container.appendChild(folderDiv);

          // Pega arquivos dentro da pasta
          const resFiles = await fetch(folder.url);
          const files = await resFiles.json();
          const mp3Files = files.filter(f => f.name.toLowerCase().endsWith(".mp3"));

          // Ordena pelos commits mais recentes
          const filesWithDate = await Promise.all(mp3Files.map(async file => {
            const commitRes = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/commits?path=${file.path}&per_page=1`);
            const commitData = await commitRes.json();
            const date = new Date(commitData[0].commit.committer.date);
            return { ...file, date };
          }));
          filesWithDate.sort((a, b) => b.date - a.date);

          // Renderiza √°udios dentro da pasta
          const folderContent = document.getElementById(folderId);
          filesWithDate.forEach(file => {
            const div = document.createElement("div");
            div.className = "podcast";
            div.innerHTML = `
              <h3>${niceTitle(file.name)}</h3>
              <audio controls preload="none" onended="playNext(this)">
                <source src="${file.download_url}" type="audio/mpeg">
                Seu navegador n√£o suporta √°udio HTML5.
              </audio>
            `;
            folderContent.appendChild(div);
          });
        }
      } catch (err) {
        console.error("Erro ao carregar pastas:", err);
      }
    }

    loadFolders();
  </script>
</body>
</html>
