<div id="folders"></div>

<script>
  const repoOwner = "jhoelrodriguespodcast";
  const repoName = "kingcast";
  const branch = "main";

  async function loadFolder(folderName) {
    try {
      const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderName}?ref=${branch}`);
      const files = await res.json();

      if (!Array.isArray(files)) {
        document.getElementById("folders").innerHTML = `<p>Erro ao carregar: ${files.message}</p>`;
        return;
      }

      const mp3Files = files.filter(file => file.name.toLowerCase().endsWith(".mp3"));

      const container = document.getElementById("folders");
      const folderDiv = document.createElement("div");
      folderDiv.className = "folder";

      const title = document.createElement("h2");
      title.textContent = folderName;

      const episodesContainer = document.createElement("div");
      episodesContainer.className = "episodes";
      episodesContainer.style.display = "none";

      // Quando clicar no nome da pasta
      title.addEventListener("click", () => {
        episodesContainer.style.display = episodesContainer.style.display === "none" ? "block" : "none";
      });

      // Cria os players de áudio
      mp3Files.forEach(file => {
        const rawUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${encodeURIComponent(file.path).replace(/%2F/g, "/")}`;
        const epDiv = document.createElement("div");
        epDiv.className = "podcast";
        epDiv.innerHTML = `
          <h3>${file.name.replace(/\.mp3$/i, "")}</h3>
          <audio controls>
            <source src="${rawUrl}" type="audio/mpeg">
            Seu navegador não suporta áudio HTML5.
          </audio>
        `;
        episodesContainer.appendChild(epDiv);
      });

      folderDiv.appendChild(title);
      folderDiv.appendChild(episodesContainer);
      container.appendChild(folderDiv);

    } catch (err) {
      document.getElementById("folders").innerHTML = `<p>Erro: ${err.message}</p>`;
    }
  }

  // Carrega só a pasta "Deus"
  loadFolder("Deus");
</script>
