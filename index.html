<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KingCast Podcast</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #333; }
    .folder { background: #fff; margin: 10px auto; border-radius: 10px; max-width: 700px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .folder-header { padding: 15px; cursor: pointer; font-weight: bold; border-bottom: 1px solid #ddd; }
    .episodes { display: none; padding: 15px; }
    .podcast { margin-bottom: 15px; }
    audio { width: 100%; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>üéôÔ∏è KingCast Podcast</h1>
  <div id="folders"></div>

  <script>
    const repoOwner = "jhoelrodriguespodcast";
    const repoName = "kingcast";

    // Pausar outros √°udios quando um come√ßar
    function setupAudioControl() {
      const audios = document.querySelectorAll("audio");
      audios.forEach(audio => {
        audio.addEventListener("play", () => {
          audios.forEach(other => {
            if (other !== audio) other.pause();
          });
        });
      });
    }

    async function loadFolders() {
      try {
        // Lista raiz do reposit√≥rio
        const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents`);
        const items = await res.json();

        // Apenas pastas
        const folders = items.filter(item => item.type === "dir");

        const container = document.getElementById("folders");
        for (const folder of folders) {
          const div = document.createElement("div");
          div.className = "folder";

          // Cabe√ßalho da pasta
          const header = document.createElement("div");
          header.className = "folder-header";
          header.textContent = "üìÇ " + folder.name;
          div.appendChild(header);

          // Container dos √°udios
          const episodes = document.createElement("div");
          episodes.className = "episodes";
          div.appendChild(episodes);

          // Toggle abrir/fechar
          header.addEventListener("click", async () => {
            if (episodes.style.display === "block") {
              episodes.style.display = "none";
              episodes.innerHTML = "";
            } else {
              episodes.style.display = "block";
              // Carregar arquivos dessa pasta
              const resFiles = await fetch(folder.url);
              const files = await resFiles.json();

              const mp3Files = files.filter(f => f.name.toLowerCase().endsWith(".mp3"));
              episodes.innerHTML = "";
              mp3Files.forEach(file => {
                const rawUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${file.path}`;
                const epDiv = document.createElement("div");
                epDiv.className = "podcast";
                epDiv.innerHTML = `
                  <h3>${file.name.replace(/\.mp3$/i, '')}</h3>
                  <audio controls>
                    <source src="${rawUrl}" type="audio/mpeg">
                    Seu navegador n√£o suporta √°udio HTML5.
                  </audio>
                `;
                episodes.appendChild(epDiv);
              });
              setupAudioControl();
            }
          });

          container.appendChild(div);
        }
      } catch (err) {
        document.getElementById("folders").innerHTML = `<p>Erro: ${err.message}</p>`;
      }
    }

    loadFolders();
  </script>
</body>
</html>
