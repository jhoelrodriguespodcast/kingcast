<script>
  const repoOwner = "jhoelrodriguespodcast";
  const repoName = "kingcast";
  const branch = "main"; // seu repositório está em main mesmo

  async function loadFolder(folder) {
    const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}?ref=${branch}`);
    const files = await res.json();

    const mp3Files = files.filter(file => file.name.toLowerCase().endsWith('.mp3'));

    const episodes = document.createElement("div");
    episodes.className = "episodes";

    mp3Files.forEach(file => {
      // Corrige espaços e acentos
      const rawUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${encodeURIComponent(file.path).replace(/%2F/g, '/')}`;

      const epDiv = document.createElement("div");
      epDiv.className = "podcast";
      epDiv.innerHTML = `
        <h3>${file.name.replace(/\.mp3$/i, '')}</h3>
        <audio controls>
          <source src="${rawUrl}" type="audio/mpeg">
          Seu navegador não suporta áudio HTML5.
        </audio>
      `;
      episodes.appendChild(epDiv);
    });

    return episodes;
  }

  async function loadFolders() {
    const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents?ref=${branch}`);
    const files = await res.json();

    const folders = files.filter(file => file.type === "dir");
    const container = document.getElementById("folders");

    folders.forEach(folder => {
      const div = document.createElement("div");
      div.className = "folder";

      const title = document.createElement("h2");
      title.textContent = folder.name;

      const episodesContainer = document.createElement("div");
      episodesContainer.className = "episodes";
      episodesContainer.style.display = "none";

      title.addEventListener("click", async () => {
        if (episodesContainer.childElementCount === 0) {
          const episodes = await loadFolder(folder.name);
          episodesContainer.appendChild(episodes);
        }
        episodesContainer.style.display = episodesContainer.style.display === "none" ? "block" : "none";
      });

      div.appendChild(title);
      div.appendChild(episodesContainer);
      container.appendChild(div);
    });
  }

  loadFolders();
</script>
